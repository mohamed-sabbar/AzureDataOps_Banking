trigger:
  branches:
    include:
      - main

pool:
  vmImage: 'ubuntu-latest'

variables:
  - group: variable group  # ton groupe de variables Azure DevOps

steps:
  # Installer Python
  - task: UsePythonVersion@0
    inputs:
      versionSpec: '3.10'
  
  # Installer requirements
  - script: |
      pip install -r requirements.txt
      pip install databricks-cli
    displayName: 'Installer d√©pendances'
  
  # Configuration Databricks CLI
  - script: |
      databricks configure --token <<EOF
      $(DATABRICKS_HOST)
      $(DATABRICKS_TOKEN)
      EOF
      echo "üîê CLI Databricks configur√©e"
    displayName: 'Configurer Databricks CLI'
    env:
      DATABRICKS_HOST: https://adb-1119135389290183.3.azuredatabricks.net
  
  # D√©ployer les notebooks dans Databricks
  - script: |
      databricks workspace import_dir notebooks /Workspace/Users/mohamedazrou2003@gmail.com --overwrite
      echo "üì• Notebooks import√©s dans Databricks"
    displayName: 'D√©ployer notebooks Databricks'
  
  # Ex√©cuter le job Databricks
  - script: |
      databricks jobs run-now --job-id 89
      echo "üöÄ Job Databricks ex√©cut√©"
    displayName: 'Lancer job Databricks'