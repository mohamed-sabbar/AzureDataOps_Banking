trigger:
  branches:
    include:
      - main  # Le pipeline dÃ©marre sur les commits vers main

pool:
  vmImage: 'ubuntu-latest'

variables:
- group: variable group   # ğŸ‘ˆ Le nom du groupe de variables que tu as crÃ©Ã© dans Azure DevOps

steps:
# Ã‰tape 1 - Choisir la version Python
- task: UsePythonVersion@0
  inputs:
    versionSpec: '3.10'

# Ã‰tape 2 - Installer les dÃ©pendances
- script: |
    pip install -r requirements.txt
    pip install databricks-cli
  displayName: 'Installer dÃ©pendances'

# Ã‰tape 3 - Configurer Databricks CLI et importer les notebooks
- script: |
    databricks configure --token <<EOF
    https://adb-1119135389290183.3.azuredatabricks.net
    $(DATABRICKS_TOKEN)
    EOF
    databricks workspace import_dir notebooks /Workspace/Users/mohamedazrou2003@gmail.com --overwrite
    echo "âœ… Notebooks importÃ©s dans Databricks"
  displayName: 'DÃ©ployer notebooks Databricks'

# Ã‰tape 4 - ExÃ©cuter un job Databricks
- script: |
    databricks jobs run-now --job-id <ID_JOB>
    echo "ğŸš€ Job Databricks exÃ©cutÃ©"
  displayName: 'ExÃ©cuter job Databricks'
